# Futevolei Game Management - Terraform & AWS Setup

This project provides infrastructure and backend setup to manage **Futevôlei games** using AWS services (Lambda, API Gateway, S3, DynamoDB) and Terraform.

---

## Prerequisites

Before you start, make sure you have the following installed and configured:

- **AWS CLI**  
  Install: [AWS CLI Installation](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)  
  Configure with credentials:
  ```bash
  aws configure
  ```

Make sure your IAM user has permissions to create:

- Lambda functions

- API Gateway

- S3 buckets

- DynamoDB tables

- IAM roles and policies

- CloudWatch logs

- **Terraform**
  Version >= 1.5 recommended.
  Install: [Terraform Installation](https://learn.hashicorp.com/tutorials/terraform/install-cli)

- **Node.js & npm**
  Required to build Lambda functions.
  Install: [Node.js](https://nodejs.org/)

- **Make**
  Required to run the provided Makefile.

---

## Project Structure

```
.
├── backend/          # Lambda functions code (Node.js)
├── frontend/         # Static frontend assets (HTML, JS, CSS)
├── infra/            # Terraform configuration files
├── Makefile          # Commands to build and deploy
└── README.md
```

---

## Step 1: Setup Terraform State

Create the S3 bucket and DynamoDB table for Terraform remote state and locking:

```bash
make setup
```

This will run a script that sets up:

- S3 bucket for Terraform state
- DynamoDB table for Terraform locks

---

## Step 2: Create Terraform Workspaces

Terraform workspaces are used to separate **dev** and **prod** environments. Run:

```bash
cd infra
terraform workspace new dev
terraform workspace new prod
```

You can select a workspace using:

```bash
terraform workspace select dev
```

---

## Step 3: Deploy the Infrastructure

Use the Makefile to deploy each environment:

- **Dev Environment:**

```bash
make dev
```

- **Prod Environment:**

```bash
make prod
```

These commands will:

1. Package the Lambda functions (`npm install` + `zip`)
2. Apply Terraform configuration to the selected workspace
3. Create S3 buckets, DynamoDB tables, Lambda functions, API Gateway resources, and permissions

---

## Step 4: Frontend Configuration

The frontend `config.js` is dynamically generated by Terraform with the API Gateway URL for the selected workspace. The `main.js` and `styles.css` files are uploaded to S3 as part of the deployment.

No manual configuration is needed for the frontend.

---

## Step 5: Access the Application

- S3 Bucket static website URL:

  ```
  http://<workspace>-futevolei-website.s3-website-us-east-1.amazonaws.com
  ```

- API Gateway URL (from Terraform outputs):

```bash
terraform output -workspace=dev api_http_url
terraform output -workspace=prod api_http_url
```

---

## Makefile Commands

| Command             | Description                                    |
| ------------------- | ---------------------------------------------- |
| `make setup`        | Prepare S3 bucket and DynamoDB table for state |
| `make dev`          | Deploy dev environment                         |
| `make prod`         | Deploy prod environment                        |
| `make dev-plan`     | Terraform plan for dev environment             |
| `make prod-plan`    | Terraform plan for prod environment            |
| `make dev-destroy`  | Destroy dev environment                        |
| `make prod-destroy` | Destroy prod environment                       |

---

## Notes

- Make sure the **dev** and **prod** workspaces exist before running `make dev` or `make prod`.
- Terraform destroy will remove AWS resources, but some global settings (API Gateway account configuration) may remain in AWS and require manual cleanup.
- Use the AWS console to monitor Lambda logs (`/aws/lambda/<function-name>`), CloudWatch, and S3 buckets.

---

## References

- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [AWS Lambda](https://docs.aws.amazon.com/lambda/latest/dg/welcome.html)
- [AWS API Gateway](https://docs.aws.amazon.com/apigateway/latest/developerguide/welcome.html)
- [AWS S3](https://docs.aws.amazon.com/s3/index.html)
- [AWS DynamoDB](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Introduction.html)
